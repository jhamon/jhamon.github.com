
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Jen Hamon</title>
  <meta name="author" content="Jen Hamon">

  
  <meta name="description" content="Asteroids is more experiment than finished game since there are no win conditions. It&rsquo;s one of the first things I made using JavaScript, and it &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jhamon.github.io/posts/3">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="Jen Hamon" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>

  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <nav id="main-nav" role="navigation">
<ul class="main-navigation">
  <li><a href="/blog/" class="nav-link">Blog</a></li>
  <li><a href="/blog/blog/archives" class="nav-link">Archives</a></li>
  <li><a href="/blog/atom.xml" class="nav-link">RSS</a></li>
  <li><a href="http://www.hamon.io/portfolio.html" class="nav-link">Portfolio</a></li>
</ul>

</nav>
  <header role="banner"><hgroup>
	
  <h1><a href="/blog/">Jen Hamon</a></h1>
  
    <h2>Rubyist and JavaScripter</h2>
  
</hgroup>

</header> 
  
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2013/10/12/asteroids/">Learning Prototypical Inheritance With Asteroids</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-12T17:28:49-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Asteroids is more experiment than finished game since there are no win conditions. It&rsquo;s one of the first things I made using JavaScript, and it was a great way to wrap my head around JavaScript&rsquo;s prototypical inheritance. The game has several different types of objects (the spaceship, bullets, asteroids) that have specific behaviors but have a common need to know where they are, move around, etc. This is easily accomplished by having a base object, MovingObject.prototype, that all other objects delegate to (a.k.a. &ldquo;inherit from&rdquo;).</p>

<p>Here&rsquo;s a simplified snippet showing the inheritance pattern:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">Asteroids</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Asteroids</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Asteroids</span> <span class="o">||</span> <span class="p">{});</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">MovingObject</span> <span class="o">=</span> <span class="nx">Asteroids</span><span class="p">.</span><span class="nx">MovingObject</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// initialization code to set up position, speed, etc.</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">MovingObject</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">move</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// complex logic to update object&#39;s position</span>
</span><span class='line'>      <span class="c1">// based on position, speed, angular velocity, </span>
</span><span class='line'>      <span class="c1">// direction, acceleration, etc.</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">Ship</span> <span class="o">=</span> <span class="nx">Asteroids</span><span class="p">.</span><span class="nx">Ship</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Ship-specific initialization would go here</span>
</span><span class='line'>      <span class="nx">Asteroids</span><span class="p">.</span><span class="nx">MovingObject</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="nx">Ship</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MovingObject</span><span class="p">();</span>
</span><span class='line'>    <span class="nx">Ship</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">Ship</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Repeat a similar procedure for Asteroid and Bullet constructors.</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>To understand what&rsquo;s happening here, you have to know that every object has a hidden <code>[[Prototype]]</code> property that is set by the constructor function at creation time to whatever is at the constructor&rsquo;s <code>.prototype</code> property. Whenever we try to access a property that an object doesn&rsquo;t have, it defers to its prototype. So when we try to access a property on an object, the interpreter will check that object, then the object&rsquo;s prototype, then the prototype&rsquo;s prototype, etc until it finds a defined property with that name or reaches the end of the prototype chain and returns undefined. This is exactly what people are talking about when they refer to the &ldquo;prototype chain&rdquo;.</p>

<p>As a more concrete example, let&rsquo;s say I want to call ship.move() on a Ship instance that I create with <code>var ship = new Asteroids.Ship()</code>. Well, ship doesn&rsquo;t have a property called move and neither does the prototype of ship (e.g. <code>Ship.prototype</code>) which was an instance of <code>MovingObject</code>. But the prototype&rsquo;s prototype, e.g. <code>MovingObject.prototype</code> will have a function under the move property name.</p>

<p>I want to give a shoutout to Kyle Simpson for explaining prototypical inheritance (better known as &ldquo;behavior delegation&rdquo;) in a way that actually makes sense.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2013/10/10/advanced-rails-validations/">Don&#8217;t Reinvent the Wheel :<br>Rails Validations Beyond the Basics</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-10T23:43:11-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you&rsquo;ve gone through a Rails tutorial like the Hartl Rails Tutorial or Rails For Zombies, you&rsquo;ll be familiar with common model validations that prevent saving duplicate or incomplete records.  Throughout this piece I&rsquo;ll be talking about a <code>Padawan</code> class, that might begin looking something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a fine first step, but it only goes a small distance toward verifying any records we might try to save are actual valid Padawans. There is a conspicuous lack of business logic. Right now anyone with an age can be saved into the database, even those who are too old to begin the training.</p>

<h2>Custom validations</h2>

<p>If we dig in a little further with documentation and Stack Overflow answers we begin to learn about defining custom validators that implement attribute checks that are tailored to our application.</p>

<p>A custom validator is just a method that adds an error message if a given conditions is not met.  A validator method that does not add any error messages is considered to have passed.  So it&rsquo;s simple to begin writing code like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:not_too_old_to_be_trained</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">not_too_old_to_be_trained</span>
</span><span class='line'>    <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="s2">&quot;is too old to be trained&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="mi">9</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can fire up the console and quickly verify this does what we expect</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">p247</span> <span class="p">:</span><span class="mo">00</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">luke</span> <span class="o">=</span> <span class="no">Padawan</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Luke Skywalker&quot;</span><span class="p">,</span> <span class="ss">age</span><span class="p">:</span> <span class="mi">25</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="k">begin</span> <span class="n">transaction</span>
</span><span class='line'>  <span class="no">Padawan</span> <span class="no">Exists</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="mi">1</span> <span class="no">AS</span> <span class="n">one</span> <span class="no">FROM</span> <span class="s2">&quot;padawans&quot;</span>  <span class="no">WHERE</span> <span class="s2">&quot;padawans&quot;</span><span class="o">.</span><span class="s2">&quot;name&quot;</span> <span class="o">=</span> <span class="s1">&#39;Luke Skywalker&#39;</span> <span class="no">LIMIT</span> <span class="mi">1</span>
</span><span class='line'>   <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="n">ms</span><span class="p">)</span>  <span class="n">rollback</span> <span class="n">transaction</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="c1">#&lt;Padawan id: nil, age: 25, name: &quot;Luke Skywalker&quot;, midichlorian_count: nil, created_at: nil, updated_at: nil&gt;</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">p247</span> <span class="p">:</span><span class="mo">00</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">luke</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;Age is too old to be trained&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Suck it, Luke Skywalker!  You&rsquo;re too old to be trained!</p>

<h2>Not the refactor you were looking for</h2>

<p>We&rsquo;re successfully keeping the old fogies out of the Jedi Academy now, but plenty of people would look at this new code and be like</p>

<blockquote><p><em>Woah, <a href="http://stackoverflow.com/questions/47882/what-is-a-magic-number-and-why-is-it-bad">magic numbers</a>! This is not the refactor you were looking for.</em></p></blockquote>

<p>Actually, they probably wouldn&rsquo;t say that. But they&rsquo;d be thinking it while they downgrade their opinion of you. So let&rsquo;s at least be a little more explicit with named constants and a bit of explanation for anybody who might work on this code after us.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Master Yoda says people over a certain age are </span>
</span><span class='line'>  <span class="c1"># too old to begin the training</span>
</span><span class='line'>  <span class="no">MAX_AGE</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:not_too_old_to_be_trained</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">not_too_old_to_be_trained</span>
</span><span class='line'>    <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="s2">&quot;is too old to be trained&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="no">MAX_AGE</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Babies with lightsabers? Oh my!</h1>

<p>If we wrote a few specs against this code, we&rsquo;d realize that even babies in diapers are able to pass the validation, which doesn&rsquo;t seem like a great idea.  Imagine the trouble a baby with a lightsaber might get into! Or a toddler who can <em>use the Force</em> during tantrums! It won&rsquo;t do.</p>

<p>Let&rsquo;s modify our validator to check against a range of ages, and give the validator a more appropriate name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Master Yoda says people over a certain age are </span>
</span><span class='line'>  <span class="c1"># too old to begin the training...</span>
</span><span class='line'>  <span class="no">MAX_AGE</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>  <span class="c1"># ...but we can&#39;t safely put lightsabers in the </span>
</span><span class='line'>  <span class="c1"># hands of babes, so we need this floor threshold too.</span>
</span><span class='line'>  <span class="no">MIN_AGE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:is_an_acceptable_age_to_be_trained</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">is_an_acceptable_age_to_be_trained</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="no">MAX_AGE</span>
</span><span class='line'>     <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="s2">&quot;is too old to be trained&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="no">MIN_AGE</span>
</span><span class='line'>     <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="s2">&quot;is too young to be trained&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have our age requirements down, we remember that <code>midichlorian_count</code> is also a factor when selecting Padawans for training.  To borrow a useful piece of Harry Potter argot, we don&rsquo;t want to waste time training squibs.  So we&rsquo;d better create a validation for midichlorians too.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Master Yoda says people over a certain age are </span>
</span><span class='line'>  <span class="c1"># too old to begin the training...</span>
</span><span class='line'>  <span class="no">MAX_AGE</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>  <span class="c1"># ...but we can&#39;t safely put lightsabers in the </span>
</span><span class='line'>  <span class="c1"># hands of babes, so we need this floor threshold too.</span>
</span><span class='line'>  <span class="no">MIN_AGE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">MIDICHLORIAN_THRESHOLD</span> <span class="o">=</span> <span class="mi">9000</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:is_an_acceptable_age_to_be_trained</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:has_enough_midichlorians</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">is_an_acceptable_age_to_be_trained</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="no">MAX_AGE</span>
</span><span class='line'>     <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="s2">&quot;is too old to be trained&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="no">MIN_AGE</span>
</span><span class='line'>     <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:age</span><span class="p">,</span> <span class="s2">&quot;is too young to be trained&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">has_enough_midichlorians</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">midichlorian_count</span> <span class="o">&lt;</span> <span class="no">MIDICHLORIAN_THRESHOLD</span>
</span><span class='line'>        <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:midichlorian_count</span><span class="p">,</span> <span class="s2">&quot;is too low to be trained&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we were writing a whole application, we could continue on adding validations in this way for quite a while.  For very small apps we might never have a problem.</p>

<h2>I felt a moderately-sized disturbance in the force</h2>

<p>If you&rsquo;re like me you might start to cringe as requirements increase and we find ourselves maintaining dozens of lines of validation code to do things as basic as checking whether a value falls within a range.  As it is, we&rsquo;re nearly up to 40 lines and all we&rsquo;ve done is check that two properties fall within a particular range. Inconcievable!</p>

<p>As we write more and more validations, patterns begin to emerge.  What&rsquo;s that, you say?  A <em>disturbance in the Force</em>? It&rsquo;s as if a thousand methods cried out all at once to be DRYed up.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Master Yoda says people over a certain age are </span>
</span><span class='line'>  <span class="c1"># too old to begin the training...</span>
</span><span class='line'>  <span class="no">MAX_AGE</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>  <span class="c1"># ...but we can&#39;t safely put lightsabers in the </span>
</span><span class='line'>  <span class="c1"># hands of babes, so we need this floor threshold too.</span>
</span><span class='line'>  <span class="no">MIN_AGE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">MIDICHLORIAN_THRESHOLD</span> <span class="o">=</span> <span class="mi">9000</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:is_an_acceptable_age_to_be_trained</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:has_enough_midichlorians</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">is_an_acceptable_age_to_be_trained</span>
</span><span class='line'>    <span class="n">attribute_greater_than_or_equal_to</span> <span class="ss">:age</span><span class="p">,</span> <span class="no">MIN_AGE</span>
</span><span class='line'>    <span class="n">attribute_less_than_or_equal_to</span> <span class="ss">:age</span><span class="p">,</span> <span class="no">MAX_AGE</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">has_enough_midichlorians</span>
</span><span class='line'>    <span class="n">attribute_greater_than_or_equal_to</span> <span class="ss">:midichlorian_count</span><span class="p">,</span>
</span><span class='line'>                                        <span class="no">MIDICHLORIAN_THRESHOLD</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">attribute_greater_than_or_equal_to</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="n">minimum</span><span class="p">)</span>
</span><span class='line'>    <span class="k">unless</span> <span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">minimum</span>
</span><span class='line'>      <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="s2">&quot;is smaller than </span><span class="si">#{</span><span class="n">minimum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">attribute_less_than_or_equal_to</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="n">maximum</span><span class="p">)</span>
</span><span class='line'>    <span class="k">unless</span> <span class="nb">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">maximum</span>
</span><span class='line'>      <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="s2">&quot;is larger than </span><span class="si">#{</span><span class="n">maximum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Is this better? Now our code is even longer than before (!), but we can see how the savings from abstracting these range checks into methods would compound as we validate more attributes in the future.</p>

<p>This is a definite step in the right direction, but it&rsquo;s beginning to look like this validation logic could probably be further generalized and be pulled into a Concern; there&rsquo;s nothing inside <code>attribute_less_than_or_equal_to</code> or <code>attribute_greater_than_or_equal_to</code> that depends on <code>Padawan</code>. If any other ActiveRecord models have similar types of validations&mdash;and we have every reason to believe that they would&mdash;we don&rsquo;t want to duplicate and maintain that code in more than one place in our project.</p>

<h1>A little knowledge is a dangerous thing</h1>

<p>So what&rsquo;s a Rails Padawan on the path to mastery to do in this situation? It turns out that the Rails developers have already solved this problem for us.</p>

<p>Custom validations are wonderful tools, but a little due diligence and study of the excellent <a href="http://guides.rubyonrails.org/active_record_validations.html">Rails Guide on ActiveRecord validations</a> at the beginning would have saved us a lot of effort in applying them in this situation. The docs show that ActiveRecord already ships with a large set of validation helpers that handle common scenarios like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Padawan</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1"># Master Yoda says people over a certain age are </span>
</span><span class='line'>  <span class="c1"># too old to begin the training...</span>
</span><span class='line'>  <span class="no">MAX_AGE</span> <span class="o">=</span> <span class="mi">9</span>
</span><span class='line'>  <span class="c1"># ...but we can&#39;t safely put lightsabers in the </span>
</span><span class='line'>  <span class="c1"># hands of babes, so we need this floor threshold too.</span>
</span><span class='line'>  <span class="no">MIN_AGE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">MIDICHLORIAN_THRESHOLD</span> <span class="o">=</span> <span class="mi">9000</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>                  <span class="ss">:numericality</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">greater_than</span><span class="p">:</span> <span class="no">MIN_AGE</span><span class="p">,</span>
</span><span class='line'>                                     <span class="ss">less_than</span><span class="p">:</span> <span class="no">MAX_AGE</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:midichlorian_count</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>            <span class="ss">:numericality</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">greater_than</span><span class="p">:</span> <span class="no">MIDICHLORIAN_THRESHOLD</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And check these out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">SithLord</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:format</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="sr">/^Darth\ /</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:lightsaber_color</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:exclusion</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">in</span><span class="p">:</span> <span class="sx">%w(green blue)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:undercover</span><span class="p">,</span>
</span><span class='line'>              <span class="ss">:inclusion</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">in</span><span class="p">:</span> <span class="o">[</span><span class="kp">true</span><span class="p">,</span> <span class="kp">false</span><span class="o">]</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:catchphrase</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="ss">minimum</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">too_short</span><span class="p">:</span> <span class="s2">&quot;must have at least %{count} characters&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>May the docs be with you!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2013/09/10/blocks/">Blocks, Procs, and Lamdas: A Tour of Anonymous Functions in Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-10T12:27:47-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Great news! Ruby has several ways of creating and passing around anonymous functions.  Key language features like the <code>Enumerable</code> module would not be possible without this capability.</p>

<p>You might not even realize that when you are using a function that takes a block, you have just written an anonymous function. An anonymous function is exactly what it sounds like: a function with no name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="sx">%w(do re mi fa so la ti)</span><span class="o">.</span><span class="n">map!</span> <span class="p">{</span> <span class="o">|</span><span class="n">note</span><span class="o">|</span> <span class="n">note</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span>
</span><span class='line'>  <span class="c1"># =&gt; [&quot;Do&quot;, &quot;Re&quot;, &quot;Mi&quot;, &quot;Fa&quot;, &quot;So&quot;, &quot;La&quot;, &quot;Ti&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this example, the <code>{ |note| note.capitalize }</code> bit is the anonymous function. Used in this way the <code>{}</code> characters are block literals, passing function expecting one variable to the higher-order <code>map!</code> method.</p>

<h2>Our own methods that take blocks</h2>

<p>We can pretty easily write our own methods that accept blocks like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">block_caller</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Hello from inside block_caller&quot;</span>
</span><span class='line'>  <span class="n">block</span><span class="o">.</span><span class="n">call</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;About to leave block_caller&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which we can use like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">block_caller</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Hello from inside the block&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1"># Hello from inside block_caller</span>
</span><span class='line'><span class="c1"># Hello from inside the block</span>
</span><span class='line'><span class="c1"># About to leave block_caller</span>
</span><span class='line'><span class="c1"># =&gt; nil</span>
</span></code></pre></td></tr></table></div></figure>


<p>We use blocks expecting an argument in a very similar way.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>    <span class="n">block</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">greeting</span><span class="p">(</span><span class="s2">&quot;Mao&quot;</span><span class="p">)</span>      <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="s2">&quot;Ni hao, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Ni hao, Mao!&quot;</span>
</span><span class='line'><span class="n">greeting</span><span class="p">(</span><span class="s2">&quot;Adolf&quot;</span><span class="p">)</span>    <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="s2">&quot;Guten Tag, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Guten Tag, Adolf!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Use <code>yield</code> for a nice performance boost</h2>

<p>There&rsquo;s an alternative syntax available to us when writing methods expecting blocks: the <code>yield</code> keyword.  We should prefer it because benchmarking shows that <code>yield</code> is about 5x faster than <code>block.call</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>    <span class="k">yield</span> <span class="nb">name</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">greeting</span><span class="p">(</span><span class="s2">&quot;Mao&quot;</span><span class="p">)</span>      <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="s2">&quot;Ni hao, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Ni hao, Mao!&quot;</span>
</span><span class='line'><span class="n">greeting</span><span class="p">(</span><span class="s2">&quot;Adolf&quot;</span><span class="p">)</span>    <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="s2">&quot;Guten Tag, </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Guten Tag, Adolf!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Overcoming limitations of blocks with Proc</h2>

<p>If you do a little experimentation, you might notice that this brace syntax is a syntactic sugar that can only be used after a method call.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span> <span class="o">|</span><span class="n">note</span><span class="o">|</span> <span class="n">note</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span>
</span><span class='line'><span class="ss">SyntaxError</span><span class="p">:</span> <span class="n">unexpected</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">expecting</span> <span class="k">end</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">input</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s also no way to pass multiple blocks to a single function.  So a very common idiom in other langauges like JavaScript is to pass multiple functions to be used in different circumstances.  For example, when making an Ajax call it&rsquo;s convenient to pass both a success and error callback so our code knows how to continue in both situations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// example.js</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">successCallback</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Take care of business</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">errorCallback</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Do damage control</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://www.example.com/api/widgets&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">success</span><span class="o">:</span> <span class="nx">successCallback</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">error</span><span class="o">:</span> <span class="nx">errorCallback</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The equivalent ruby would be something like</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">ajax</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># ... where the magic happens</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t use blocks to send <code>success</code> and <code>error</code> callbacks to this method. To accomplish this type of feat with Ruby, we have to use <code>Proc</code> objects, which Ruby provides as a way of wrapping a block into an object that may be passed around and used in multiple places. This is useful to use because methods can accept an arbitrary number of object parameters.</p>

<p>The simplest possible example of a <code>Proc</code> would be something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">capitalizer</span> <span class="o">=</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">str</span><span class="o">|</span> <span class="n">str</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">capitalizer</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;obama&quot;</span><span class="p">)</span> <span class="c1"># =&gt; &quot;Obama&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using <code>Proc</code> and keeping in mind that blocks are closures, we can write functions that return Procs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">make_counter</span><span class="p">()</span>
</span><span class='line'>  <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">counter</span> <span class="o">=</span> <span class="n">make_counter</span><span class="p">()</span>
</span><span class='line'><span class="n">counter</span><span class="o">.</span><span class="n">call</span><span class="p">()</span> <span class="c1"># =&gt; 1</span>
</span><span class='line'><span class="n">counter</span><span class="o">.</span><span class="n">call</span><span class="p">()</span> <span class="c1"># =&gt; 2</span>
</span><span class='line'><span class="n">counter</span><span class="o">.</span><span class="n">call</span><span class="p">()</span> <span class="c1"># =&gt; 3</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Using a proc where a block is expected</h2>

<p>If we need to use a proc where a block is expected, we can use the <code>&amp;</code> operator.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">add_five</span> <span class="o">=</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5</span> <span class="p">}</span>
</span><span class='line'><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">].</span><span class="n">map</span> <span class="o">&amp;</span><span class="n">add_five</span>
</span><span class='line'><span class="c1"># =&gt; [6, 7, 8, 9]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Choose your own syntax</h2>

<p>Because Ruby likes to have multiple ways to accomplish everything, we&rsquo;ve got several different sytnaxes available to us for constructing <code>Proc</code> objects.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># Create a Proc object directly</span>
</span><span class='line'>  <span class="no">Proc</span><span class="o">.</span><span class="n">new</span>  <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">|</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Use this Kernal method</span>
</span><span class='line'>  <span class="nb">proc</span>      <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">|</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Or this Kernal method</span>
</span><span class='line'>  <span class="nb">lambda</span>    <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">|</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Or the &quot;stabby lambda&quot; syntax</span>
</span><span class='line'>  <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Proc methods and lambda methods are almost exactly the same except for the <a href="http://stackoverflow.com/questions/626/when-to-use-lambda-when-to-use-proc-new">strange way</a> the <code>return</code> keyword is handled in procs created with <code>Proc.new</code>.</p>

<p>The &ldquo;stabby lambda&rdquo; syntax, though probably the ugliest of all, can do something that none of the others can and that is specify default parameters similar to a normal method declaration.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">adder</span> <span class="o">=</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="p">}</span>
</span><span class='line'><span class="n">adder</span><span class="o">.</span><span class="n">call</span><span class="p">()</span> <span class="c1"># =&gt; 9</span>
</span></code></pre></td></tr></table></div></figure>


<p>Handy!</p>

<h2>Gimme that method</h2>

<p>One final trick to have up your sleeve it the ability to reach inside an object and turn any method into a <code>Proc</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Pig</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">oink</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Oink!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">wilbur</span> <span class="o">=</span> <span class="no">Pig</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">oinker</span> <span class="o">=</span> <span class="n">wilbur</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="ss">:oink</span><span class="p">)</span><span class="o">.</span><span class="n">to_proc</span>
</span><span class='line'><span class="n">oinker</span><span class="o">.</span><span class="n">call</span>
</span><span class='line'><span class="c1"># Oink!</span>
</span><span class='line'><span class="c1"># =&gt; nil</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Summary</h2>

<p>Amazing! That concludes the tour of ruby&rsquo;s blocks, procs, and lambdas.</p>

<p>To summarize:</p>

<ul>
<li>Use blocks for one-off inline anonymous functions.</li>
<li>Use <code>Proc.new</code> if you need to reuse a code multiple times or need to pass multiple functions as arguments to the same function.</li>
<li>Use <code>-&gt;</code> if you want to specify default parameters for your anonymous function.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2013/02/28/why-i-quit-my-caltech-phd/">Why I&#8217;m Quitting My Caltech PhD</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-28T11:28:02-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For those who don&rsquo;t know, I&rsquo;ve been working on a PhD at the intersection of geology and geophysics. I will be leaving with a Master&rsquo;s degree at the end of this year.</p>

<p>I was originally attracted to geosciences because from 30,000 feet the subject matter has a definite aesthetic appeal.  When I think about the scale and size and antiquity of the Earth, I feel humble and in awe that I even exist at all.  I&rsquo;m not a religious person, but that feeling of awe toward nature is what originally attracted me to science as vocation.</p>

<p>But over the past few years I&rsquo;ve learned that those feelings of awe have relatively little to do with the day-to-day life of a person in academia. I&rsquo;ve been telling myself for a while now that I have a decision to make about whether to stay in science.  About whether this PhD is really the on-ramp to a career that I want.</p>

<p>But the truth is I have already decided; the crossroads is weeks (months?) in the rearview mirror.  Even though I&rsquo;ve been afraid to tell colleagues about my decision, for those paying attention my choices over the last several months paint a clear picture of my priorities.  I decided when I started researching opportunities outside the scientific realm.  I decided when I started ignoring my homework to go to local tech meetups and work on programming.  I decided when I spent my weekend applying to Hacker School instead of a small grant opportunity.</p>

<p>I do feel guilty about leaving the program after taking up other peoples&#8217; time and resources.  I have nothing but warm feelings for my advisor, who I am sad to let them down.  But guilty feelings are not good reasons to stay, not when the opportunity cost of staying is so absurdly high.</p>

<h2>I don&rsquo;t love it</h2>

<p>The department chair said yesterday in a graduate student meeting that if you don&rsquo;t love what you&rsquo;re doing then science isn&rsquo;t worth it.  The message resonated deeply with me.</p>

<p>Because the truth is that I don&rsquo;t love it.  I don&rsquo;t love trying to build a personal brand in the prestige economy that science turns on.  Even if my work was groundbreaking (it isn&rsquo;t), I know that I don&rsquo;t have the social temperament of a successful scientist.  The only way that your work adds value to your career in science is if you spend a lot of energy pimping and promoting and talking up your work at every opportunity.  I don&rsquo;t love that.  In fact, I don&rsquo;t like that at all.</p>

<p>I don&rsquo;t love feeling like I need to be the best in the world at my particular thing just to have a <em>chance</em> at success, and even then it&rsquo;s only a chance because so much luck is involved.  I take pride in my work and aim to be the best, but <em>best in the world</em> is an insanely high bar.  This is the expectation at high-level science programs, and it seems like an unhealthy way to approach work.</p>

<p>I don&rsquo;t love working in isolation on things that nobody cares about, that few people will read, and that affect nobody&rsquo;s life.  I am terrified by the truth in this John Ziman quote:</p>

<blockquote><p>A scientist is a person who knows more and more about less and less, until he knows everything about nothing.</p></blockquote>

<p>If that&rsquo;s what it means to be a successful scientific professional, I want no part of it. I want to keep learning about lots of different types of things throughout my career, not going ever deeper into the minutiae of one specific subfield.</p>

<p>I don&rsquo;t love getting by on a meager stipend while my friends who got real jobs after college are buying cars, saving for retirement, and starting businesses. If there were some great opportunities waiting for me at the end of a PhD it might be worth it.  But there aren&rsquo;t. Economically, there&rsquo;s no way to justify working for such a pittance for your entire youth unless you are so passionate about the work that you can&rsquo;t see yourself doing anything else.</p>

<p>Even if the money were not an issue, I don&rsquo;t love contemplating a future where the well-known &ldquo;two-body problem&rdquo; means there&rsquo;s a good chance I&rsquo;ll have to choose between optimizing for career and optimizing for family. As far as I know, no other professional field routinely expects participants to enter something as perverse as a <em>permanent long-distance marriage</em> (and <a href="http://www.salon.com/1999/03/25/24feature_5/">probable divorce</a>) in service of their career.</p>

<p>And finally, I don&rsquo;t love being part of a culture where everyone is afraid all the time.  Some might disagree with this, but I would claim there is a general feeling of fear pervading academic life. Everyone is afraid their project won&rsquo;t work, afraid their paper won&rsquo;t get published, afraid they aren&rsquo;t working enough, afraid somebody will make them look dumb, afraid somebody will copy their idea, afraid they won&rsquo;t get a job, afraid the grant that they depend on won&rsquo;t get renewed, and so on.  I see this from top to bottom in staff, junior faculty, and students.</p>

<p>I don&rsquo;t love it.  And I&rsquo;ve had enough.</p>

<p>Coming this realization has been a scary process.  Overcoming the special brand of Stockholm syndrome that makes graduate students speak about &ldquo;leaving Science&rdquo; in hushed tones has been a long road.  Anyone who has dropped out of a top tier graduate program can tell you, it takes a lot of courage to break out of the bubble and realize how much opportunity there is out there in the wider world.</p>

<p>Now that I&rsquo;ve come to a decision it feel good. It feels right. For the first time in a long time, I feel optimistic about what the future holds. I&rsquo;m excited to get started.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2012/01/17/not-your-grandmothers-flashcards/">Not Your Grandmother&#8217;s Flashcards</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-17T02:43:01-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Richard Feynmann famously bemoaned the way that too many students memorized
instead of thought their way through problems.  Over the years the pendulum has swung very far in the othe direction, to the point that the only time I remember anyone being asked to perform moderate feats of memorization were for Organic Chemistry.</p>

<p>But it seems like that laizze faire approach to memorization has not been carried through all the way to graduate school and into academic life.  It seems that memorizing things is a  too-often neglected part of developing expertise.  Sure, it&rsquo;s great to be <em>smart</em>, but if at the end of the day you
don&rsquo;t really <em>know things</em> then what kind of expert are you, really?</p>

<p>This reality about the need to know things cold is one of the first hard truths
I ran into during graduate school.  Being clever enough to <em>figure things out</em>
was enough to get by as an undergraduate.  But I&rsquo;m certain that anybody who has
worked on a science PhD would agree that no amount of cleverness will save you
when the committee in your qualifying exam uncovers the gaping holes in your factual recall that keep you from tackling their problems spontaneously and fluidly.  Suddenly, all those <em>details</em> I &ldquo;learned&rdquo; and subsequently forgot as an undergradute seem like a collasal missed opportunity.</p>

<p>Just today I was in a lecture class where a professor walked up to the
blackboard and asked the class, <em>&ldquo;Who remembers the mineral formula for
olivine?&rdquo;</em>  Later, <em>&ldquo;Can anyone tell me the difference between a clinopyroxene
and an orthopyroxene?&rdquo;</em> Jargon aside, these are extremely common minerals that
any good geology student should be well acquainted with.  But other than a few
mubles there wasn&rsquo;t much response from the class. Usually there will be silence
when these type of questions are posed because very few people are confident in
their knowledge of the answer and none percieve an incentive that outweights the potential embarassment of getting such a basic question wrong. I sat there
feeling pretty sure but not certain that I knew the answer as the professor gave a gruff admonition that, &ldquo;You should all really know this for your quals.&rdquo;</p>

<p>To those who&rsquo;ve been to grad school this might feel like a familiar scenario.
It&rsquo;s one that nearly caused me to drop out of graduate school, and I know it is
a source of anxiety for many of my fellow students.  The mixture of shame,
frustration, and anxiety that comes from not being able to remember those things that are simultaneously fundamental, familiar, and easy to understand cannot be overstated.</p>

<p>I, and I&rsquo;m sure others, blame ourselves for these feelings, but the truth is
that nobody in our educational legacy ever gave us the tools to learn and retain
information.  Memorization as a teaching philosophy has been out of fashion for
many years now, so that the current products of the public education system have
never been asked to actually <em>memorize</em> anything.  The sad truth of it is,
though, that if you aren&rsquo;t being asked to memorize anything while moving through
a content-based educational curriculum (e.g. history, social studies, etc), then
you aren&rsquo;t really being asked to do anything at all of lasting educational
value.</p>

<h1>Embracing memorization</h1>

<p>Many people, including myself in the past, hate being asked to memorize things
because it seems boring and frustrating to go over the same material again and
again. But it doesn&rsquo;t have to be quite so bleak.  I have recently learned about
a study technique called <a href="http://www.wired.com/medtech/health/magazine/16-05/ff_wozniak?currentPage=all"><em>spaced
repetition</em></a>
which memory experts say will help us to memorize more efficiently.  The
research suggests that memories decay exponentially if they are not systematically
reinforced.  The brain essentially garbage collects all the information it soaks
up and hasn&rsquo;t used in a while.  Without systematic review eventually everything
of substance just evaporates leaving nothing but the vague feeling of having
seen something before.</p>

<p>Flashcards are an obvious tool for reviews, but I find them difficult
to make by hand and annoying to carry around.  Fortunately, in the last decade
or so several bits of software have been written to help people manage large
digital collections of electronic flashcards.  These applications, termed
<a href="http://en.wikipedia.org/wiki/Spaced_repetition">&ldquo;Spaced Repetition Systems,&rdquo;</a>
help you schedule reviews to maximize learning over the long term.</p>

<p>Some of the most popular are:</p>

<ul>
<li><strong><a href="http://ankisrs.net/">Anki</a></strong> (free, cross platform)</li>
<li><a href="http://www.mnemosyne-proj.org/">Mnemosyne</a> (free, cross platform)</li>
<li><a href="http://www.supermemo.com/">SuperMemo</a> (paid, Windows only)</li>
<li><a href="http://orgmode.org/worg/org-contrib/org-drill.html">Org-Drill</a>,</li>
<li>part of Org-Mode in Emacs (free, cross platform)</li>
</ul>


<p>These systems have the user rate themselves on how well they know each card and
then uses an algorithm to figure out when they should study the card again.  The
best time to study a card is right before you forget it.  Each time the user
answers a card correctly the interval gets a little longer, until pretty soon a
card only needs one or two reps per year to be maintained in memory. Forgetting
a card resets the interval to daily reviews.</p>

<p>Even if you think you hate flashcards, I&rsquo;d recommend giving this method of study
a fresh look.  Really knowing things is such a high, I think you&rsquo;ll quickly come
around to liking them.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jen Hamon -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
